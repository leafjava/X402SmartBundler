<!DOCTYPE html>
<html>
<head>
  <title>æ£€æŸ¥ç½‘ç»œå’Œåˆçº¦</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
    button { padding: 10px 20px; margin: 10px 0; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 5px; font-size: 16px; }
    button:hover { background: #45a049; }
    .result { background: #2a2a2a; padding: 15px; margin: 10px 0; border-radius: 5px; min-height: 50px; }
    .error { color: #ff5555; }
    .success { color: #50fa7b; }
    .warning { color: #ffb86c; }
  </style>
</head>
<body>
  <h1>ğŸ” ç½‘ç»œå’Œåˆçº¦æ£€æŸ¥å·¥å…·</h1>
  
  <button onclick="checkNetwork()">1. æ£€æŸ¥å½“å‰ç½‘ç»œ</button>
  <div id="network-result" class="result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æ£€æŸ¥...</div>
  
  <button onclick="checkContract()">2. æ£€æŸ¥åˆçº¦çŠ¶æ€</button>
  <div id="contract-result" class="result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æ£€æŸ¥...</div>
  
  <button onclick="testPayment()">3. æµ‹è¯•æ”¯ä»˜è°ƒç”¨</button>
  <div id="payment-result" class="result">ç‚¹å‡»æŒ‰é’®å¼€å§‹æ£€æŸ¥...</div>

  <script>
    const CONTRACT_ADDRESS = '0x45E1E7796e11156d12621687d0Fa052f52A4Db51';
    
    async function checkNetwork() {
      const result = document.getElementById('network-result');
      result.innerHTML = 'æ£€æŸ¥ä¸­...';
      
      try {
        if (!window.ethereum) {
          result.innerHTML = '<span class="error">âŒ æœªæ£€æµ‹åˆ°é’±åŒ… (MetaMask/OKX)</span>';
          return;
        }
        
        // æ£€æµ‹é’±åŒ…ç±»å‹
        const walletType = window.ethereum.isMetaMask ? 'MetaMask' : 
                          window.okxwallet ? 'OKX Wallet' : 'æœªçŸ¥é’±åŒ…';
        console.log('æ£€æµ‹åˆ°é’±åŒ…:', walletType);
        
        const chainId = await window.ethereum.request({ method: 'eth_chainId' });
        const chainIdDec = parseInt(chainId, 16);
        
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const account = accounts[0];
        
        const balance = await window.ethereum.request({
          method: 'eth_getBalance',
          params: [account, 'latest']
        });
        const balanceEth = parseInt(balance, 16) / 1e18;
        
        const networks = {
          1: 'Ethereum Mainnet',
          11155111: 'Sepolia Testnet',
          8453: 'Base Mainnet',
          84532: 'Base Sepolia',
          1337: 'Localhost'
        };
        
        const networkName = networks[chainIdDec] || 'æœªçŸ¥ç½‘ç»œ';
        const isCorrect = chainIdDec === 11155111;
        
        let html = '<div class="' + (isCorrect ? 'success' : 'error') + '">';
        html += '<strong>å½“å‰ç½‘ç»œ:</strong> ' + networkName + ' (Chain ID: ' + chainIdDec + ')';
        html += isCorrect ? ' âœ… æ­£ç¡®' : ' âŒ é”™è¯¯ï¼åº”è¯¥è¿æ¥åˆ° Sepolia (11155111)';
        html += '</div>';
        html += '<div><strong>è´¦æˆ·:</strong> ' + account + '</div>';
        html += '<div><strong>ä½™é¢:</strong> ' + balanceEth.toFixed(4) + ' ETH</div>';
        
        result.innerHTML = html;
      } catch (error) {
        result.innerHTML = '<span class="error">âŒ é”™è¯¯: ' + error.message + '</span>';
      }
    }
    
    async function checkContract() {
      const result = document.getElementById('contract-result');
      result.innerHTML = 'æ£€æŸ¥ä¸­...';
      
      try {
        const code = await window.ethereum.request({
          method: 'eth_getCode',
          params: [CONTRACT_ADDRESS, 'latest']
        });
        
        const exists = code !== '0x';
        
        if (!exists) {
          let html = '<span class="error">âŒ åˆçº¦ä¸å­˜åœ¨ï¼</span>';
          html += '<div>åœ°å€: ' + CONTRACT_ADDRESS + '</div>';
          html += '<div class="warning">âš ï¸ è¯·ç¡®è®¤:</div>';
          html += '<div>1. åˆçº¦æ˜¯å¦å·²éƒ¨ç½²åˆ°å½“å‰ç½‘ç»œ</div>';
          html += '<div>2. åˆçº¦åœ°å€æ˜¯å¦æ­£ç¡®</div>';
          result.innerHTML = html;
          return;
        }
        
        const minUsdData = await window.ethereum.request({
          method: 'eth_call',
          params: [{
            to: CONTRACT_ADDRESS,
            data: '0x6bb3da7a'
          }, 'latest']
        });
        
        const minUsd = parseInt(minUsdData, 16);
        
        let html = '<div class="success">âœ… åˆçº¦å­˜åœ¨</div>';
        html += '<div><strong>åœ°å€:</strong> ' + CONTRACT_ADDRESS + '</div>';
        html += '<div><strong>ä»£ç é•¿åº¦:</strong> ' + code.length + ' bytes</div>';
        html += '<div><strong>MIN_USD:</strong> ' + minUsd + ' wei = ' + (minUsd / 1e18) + ' (18 decimals)</div>';
        
        result.innerHTML = html;
      } catch (error) {
        result.innerHTML = '<span class="error">âŒ é”™è¯¯: ' + error.message + '</span>';
      }
    }
    
    async function testPayment() {
      const result = document.getElementById('payment-result');
      result.innerHTML = 'æµ‹è¯•ä¸­...';
      
      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const account = accounts[0];
        
        const amounts = [
          { name: '0.0001 ETH', hex: '0x5AF3107A4000' },
          { name: '0.001 ETH', hex: '0x38D7EA4C68000' },
          { name: '0.01 ETH', hex: '0x2386F26FC10000' },
        ];
        
        let html = '<div><strong>Gas ä¼°ç®—æµ‹è¯•:</strong></div>';
        
        for (const amount of amounts) {
          try {
            const gas = await window.ethereum.request({
              method: 'eth_estimateGas',
              params: [{
                from: account,
                to: CONTRACT_ADDRESS,
                data: '0xb4cb0352',
                value: amount.hex
              }]
            });
            
            html += '<div class="success">âœ… ' + amount.name + ' - Gas: ' + parseInt(gas, 16) + '</div>';
          } catch (error) {
            const errorMsg = error.message.split('\n')[0];
            html += '<div class="error">âŒ ' + amount.name + ' - ' + errorMsg + '</div>';
          }
        }
        
        result.innerHTML = html;
      } catch (error) {
        result.innerHTML = '<span class="error">âŒ é”™è¯¯: ' + error.message + '</span>';
      }
    }
  </script>
</body>
</html>
